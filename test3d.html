<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Botella 3D Krautermeister</title>
  <style>
    * { margin: 0; padding: 0; }
    body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(135deg, #0a1410 0%, #1a2f26 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: Arial, sans-serif;
    }
    #loading {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background: #f59e0b;
      color: white;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
    }
    #loaded {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background: #4ade80;
      color: white;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
      display: none;
    }
  </style>
</head>
<body>
  <div id="loading">‚è≥ Cargando botella...</div>
  <div id="loaded">‚úÖ botella Cargada</div>

  <script src="three.min.js"></script>
  <script src="GLTFLoader.js"></script>
  <script src="DRACOLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.0/dist/gsap.min.js"></script>

  <script>
    window.addEventListener('load', () => {
      console.log('1Ô∏è‚É£ Verificando THREE.js...', typeof THREE);
      console.log('2Ô∏è‚É£ Verificando GLTFLoader...', typeof THREE?.GLTFLoader);
      console.log('3Ô∏è‚É£ Verificando DRACOLoader...', typeof THREE?.DRACOLoader);

      // Escena
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0a1410);

      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.set(0, 1.5, 3);

      // Renderer
      const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0x0a1410, 1);
      document.body.appendChild(renderer.domElement);

      // Luces
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xff9944, 0.8);
      directionalLight.position.set(5, 5, 5);
      scene.add(directionalLight);

      // PRIMERO: Cubo de prueba para verificar Three.js
      const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
      const material = new THREE.MeshPhongMaterial({ color: 0xff9944 });
      const cube = new THREE.Mesh(geometry, material);
      cube.position.set(0, 2, 0);
      scene.add(cube);
      console.log('‚úÖ Cubo de prueba a√±adido');

      // SEGUNDO: Intentar cargar botella
      if (typeof THREE?.GLTFLoader === 'function') {
        const loader = new THREE.GLTFLoader();
        
        // Intentar ignorar errores de DRACO
        loader.manager.onError = (url) => {
          console.warn(`‚ö†Ô∏è No se pudo cargar: ${url}`);
        };
        
        console.log('‚è≥ Iniciando carga de bottle-v1.glb...');
        document.getElementById('loading').textContent = '‚è≥ Cargando botella...';

        let loadTimeout = setTimeout(() => {
          console.warn('‚è±Ô∏è Timeout: bottle.glb tard√≥ m√°s de 10 segundos');
          document.getElementById('loading').textContent = '‚è±Ô∏è Cargando (lento)...';
        }, 10000);

        loader.load(
          'bottle-v1.glb',
          (gltf) => {
            clearTimeout(loadTimeout);
            console.log('‚úÖ BOTELLA CARGADA EXITOSAMENTE');
            
            const bottle = gltf.scene;
            console.log('Objeto botella:', bottle);
            console.log('Children count:', bottle.children.length);
            
            // Calcular bounding box para ajustar escala autom√°ticamente
            const bbox = new THREE.Box3().setFromObject(bottle);
            const size = bbox.getSize(new THREE.Vector3());
            console.log('Tama√±o de la botella:', size);
            
            const center = bbox.getCenter(new THREE.Vector3());
            const maxDim = Math.max(size.x, size.y, size.z);
            const scale = 3 / maxDim;
            bottle.scale.multiplyScalar(scale);
            bottle.position.sub(center.multiplyScalar(scale));
            
            scene.remove(cube);
            scene.add(bottle);

            document.getElementById('loading').style.display = 'none';
            document.getElementById('loaded').style.display = 'block';

            gsap.to(bottle.rotation, {
              y: Math.PI * 2,
              duration: 6,
              repeat: -1,
              ease: 'none'
            });
            
            console.log('üéâ Botella girando y lista');
          },
          (progress) => {
            const percent = Math.round((progress.loaded / progress.total) * 100);
            console.log(`üì• Progreso: ${percent}%`);
          },
          (error) => {
            clearTimeout(loadTimeout);
            
            // Si el error es por DRACO, intentar de todos modos
            if (error.message?.includes('DRACO') || error.message?.includes('Draco')) {
              console.warn('‚ö†Ô∏è DRACO no disponible, pero intentando cargar de todos modos...');
              // Intentar cargar nuevamente sin esperar DRACO
              setTimeout(() => {
                loader.load('bottle-v1.glb', 
                  (gltf) => {
                    console.log('‚úÖ Se carg√≥ sin DRACO');
                    // ... mismo c√≥digo del callback anterior
                  },
                  undefined,
                  () => {
                    console.error('‚ùå No se pudo cargar incluso sin DRACO');
                    document.getElementById('loading').textContent = '‚ùå No se pudo cargar la botella';
                  }
                );
              }, 1000);
            } else {
              console.error('‚ùå ERROR CARGANDO BOTELLA:', error);
              console.error('Mensaje:', error.message);
              document.getElementById('loading').textContent = '‚ùå ' + error.message;
            }
          }
        );
      } else {
        console.error('‚ùå GLTFLoader no disponible');
        document.getElementById('loading').textContent = '‚ùå GLTFLoader no disponible';
      }

      // Render loop
      function animate() {
        requestAnimationFrame(animate);
        cube.rotation.x += 0.01;
        cube.rotation.y += 0.01;
        renderer.render(scene, camera);
      }
      animate();

      // Resize
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      console.log('üöÄ Three.js inicializado');
    });
  </script>
</body>
</html>
